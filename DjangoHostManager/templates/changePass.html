
{% extends 'base.html' %}

{% block title %}修改密码{% endblock %}

{% block content %}
    <div class="container">
	<div class="title"><h1>修改密码</h1></div>
	<div class="main">

		<div class="box">
            <!--<form name="form1" method="post" action="/master/user/repass" onsubmit="javascript:return $.form.post(this);">-->
            <form id="form1" method="POST">
                {% csrf_token %}
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="edit-box">
                <tbody>
                <tr style="display: none">
                    <td width="120" valign="top" style="line-height:36px">用户名：</td>
                    <td><input name="username" value="{{ request.user }}" type="text" class="form-input" id="username" style="width:360px;" placeholder="用户名">
                    </td>
                </tr>
                <tr>
                    <td width="120" valign="top" style="line-height:36px">原有密码：</td>
                    <td><input name="oldpassword" type="password" class="form-input" id="oldpassword" style="width:360px;" placeholder="原有密码">
                    </td>
                </tr>
                <tr>
                    <td width="120" valign="top" style="line-height:36px">设新密码：</td>
                    <td><input name="newpassword" type="password" class="form-input" id="newpassword" style="width:360px;" placeholder="请输入新的密码">
                    </td>
                </tr>
                <tr>
                    <td width="120" valign="top" style="line-height:36px">重复密码：</td>
                    <td><input name="renewpassword" type="password" class="form-input" id="renewpassword" style="width:360px;" placeholder="请再次输入新密码,测试完请修改回来">
                    </td>
                </tr>
                <tr>
                    <td width="100">&nbsp;</td>
                    <td><input type="button" id="changePass" class="btn btn-blue btn-float r15" value="修改密码"/></td>
                </tr>
                </tbody>
            </table>

            </form>
        </div>
	</div>
</div>

<script>
/*
    function changePassword() {
        if (!$('#oldpassword').val()){alert("旧密码不能为空!");}
        if (!$('#newpassword').val()){alert("新密码不能为空!");}
        if (!$('#renewpassword').val()){alert("确认密码不能为空!");}
        if ($('#newpassword').val() != $('#renewpassword').val()){alert("两次密码不一致!");}
        if ($('#oldpassword').val() == $('#newpassword').val()){alert("新密码和旧密码不能一样!");}
        else{
            $.ajax({
                url:"/master/user/repass/",
                type:'POST',
                data:{'username':$('#username').val(),'oldpassword':$('#oldpassword').val(),'newpassword':$('#newpassword').val(),},
                success:function (data, textStatus){
                    console.log(data)
                    if (data == 'OK'){
                        alert('修改成功!');
                        window.location.href = '/master/index/';
                    }else{
                        alert(data);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                },
            });
        }
    }
*/

     $('#changePass').click(function () {
         if (!$('#oldpassword').val()){alert("旧密码不能为空!");}
        if (!$('#newpassword').val()){alert("新密码不能为空!");}
        if (!$('#renewpassword').val()){alert("确认密码不能为空!");}
        if ($('#newpassword').val() != $('#renewpassword').val()){alert("两次密码不一致!");}
        if ($('#oldpassword').val() == $('#newpassword').val()){alert("新密码和旧密码不能一样!");}
        else{
            $.ajax({
                url:"/master/user/repass/",
                type:'POST',
                data:{'username':$('#username').val(),'oldpassword':$('#oldpassword').val(),'newpassword':$('#newpassword').val(),},
                success:function (data, textStatus){
                    console.log(data)
                    if (data == 'OK'){
                        alert('修改成功!');
                        window.location.href = '/master/index/';
                    }else{
                        alert(data);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                },
            });
        }
    })
</script>
{% endblock %}